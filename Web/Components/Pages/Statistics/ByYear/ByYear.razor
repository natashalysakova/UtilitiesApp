@using ApexCharts;

@if (Checks is null)
{
    return;
}

@{
    var title = $"Споживання за " + (_yearSelected == 0 ? "усі роки" : _yearSelected + " рік");
}

<MudSelect Variant="Variant.Outlined" T="int" @bind-Value="@_yearSelected" SelectedValuesChanged="ReloadCharts">
    <MudSelectItem Value="0">Усі роки</MudSelectItem>
    @foreach (var item in _yearsList)
    {
        <MudSelectItem Value="@item">@item</MudSelectItem>
    }
</MudSelect>

<ByYearMetersApex SelectedYear="@_yearSelected" Checks="@Checks"></ByYearMetersApex>
<MudExpansionPanels>
    <MudExpansionPanel Text="За обсягом спожитого" >
        <ByYearVolume SelectedYear="@_yearSelected" Checks="@Checks"></ByYearVolume>
    </MudExpansionPanel>
    <MudExpansionPanel Text="Не фіксовані платежі" >
        <ByYearNotFixedApex SelectedYear="@_yearSelected" Checks="@Checks"></ByYearNotFixedApex>
    </MudExpansionPanel>
</MudExpansionPanels>

@code {
    [Parameter, EditorRequired]
    public IEnumerable<CheckViewDto>? Checks { get; set; }

    private int _yearSelected = 0;
    private IEnumerable<int> _yearsList = new List<int>();

    private void ReloadCharts()
    {
        StateHasChanged();
    }

    protected override void OnParametersSet()
    {
        if (Checks != null)
        {
            _yearsList = Checks.Select(x => x.Date.Year).Distinct().Order();
            _yearSelected = 0;
        }
    }

    protected override void OnInitialized()
    {

    }
}
